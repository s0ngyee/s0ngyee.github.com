<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[s0ngyee]]></title>
  <link href="http://blog.songyee.com/atom.xml" rel="self"/>
  <link href="http://blog.songyee.com/"/>
  <updated>2013-01-23T10:43:32+08:00</updated>
  <id>http://blog.songyee.com/</id>
  <author>
    <name><![CDATA[s0ngyee Bian]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[为Octopress添加Tag Clouds]]></title>
    <link href="http://blog.songyee.com/blog/2013/01/21/wei-octopresstian-jia-tag-clouds/"/>
    <updated>2013-01-21T12:12:00+08:00</updated>
    <id>http://blog.songyee.com/blog/2013/01/21/wei-octopresstian-jia-tag-clouds</id>
    <content type="html"><![CDATA[<p>给blog添加了标签云的功能，不支持中文。</p>

<p>记录一下折腾流程。</p>

<!--more-->


<p>主要流程参照<a href="http://agiledon.github.com/blog/2013/01/08/create-tag-for-octopress/">这篇</a></p>

<h3>Tag Cloud插件</h3>

<p>通过修改第三方插件<a href="https://github.com/bizkit/octopress-cumulus">octopress-cumulus</a>来实现Tag Cloud的功能。</p>

<p>按原文的说法这个插件实质是category cloud的插件，因为category 和tag表示不同的维度，要用tag cloud就在这个基础上进行修改。</p>

<p>下载源码后将插件用到的文件复制到octopress的相应目录tagcloud.swf和category_generator.rb（octopress自带的插件，源码中没有找到）用于生成3D效果Flash，category_cloud.html边栏模板。</p>

<h3>生成Tag目录</h3>

<p>插件plugins/tag_generator.rb 是根据系统自带的category_generator.rb 修改的，主要功能用于读取post的markdown文件里的tags标签值，并生成相应目录，代码如下:</p>

<figure class='code'><figcaption><span>tag_generator.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Jekyll</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># The TagIndex class creates a single tag page for the specified tag.</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">TagIndex</span> <span class="o">&lt;</span> <span class="no">Page</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Initializes a new TagIndex.</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1">#  +base+         is the String path to the &lt;source&gt;.</span>
</span><span class='line'>    <span class="c1">#  +tag_dir+ is the String path between &lt;source&gt; and the tag folder.</span>
</span><span class='line'>    <span class="c1">#  +tag+     is the tag currently being processed.</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">tag_dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>      <span class="vi">@base</span> <span class="o">=</span> <span class="n">base</span>
</span><span class='line'>      <span class="vi">@dir</span>  <span class="o">=</span> <span class="n">tag_dir</span>
</span><span class='line'>      <span class="vi">@name</span> <span class="o">=</span> <span class="s1">&#39;index.html&#39;</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="vi">@name</span><span class="p">)</span>
</span><span class='line'>      <span class="c1"># Read the YAML data from the layout page.</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">read_yaml</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;_layouts&#39;</span><span class="p">),</span> <span class="s1">&#39;tag_index.html&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;tag&#39;</span><span class="o">]</span>    <span class="o">=</span> <span class="n">tag</span>
</span><span class='line'>      <span class="c1"># Set the title for this page.</span>
</span><span class='line'>      <span class="n">title_prefix</span>             <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="s1">&#39;tag_title_prefix&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;Tag: &#39;</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;title&#39;</span><span class="o">]</span>       <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">title_prefix</span><span class="si">}#{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="c1"># Set the meta-description for this page.</span>
</span><span class='line'>      <span class="n">meta_description_prefix</span>  <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="s1">&#39;tag_meta_description_prefix&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;Tag: &#39;</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;description&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">meta_description_prefix</span><span class="si">}#{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># The tagFeed class creates an Atom feed for the specified tag.</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">TagFeed</span> <span class="o">&lt;</span> <span class="no">Page</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Initializes a new tagFeed.</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1">#  +base+         is the String path to the &lt;source&gt;.</span>
</span><span class='line'>    <span class="c1">#  +tag_dir+ is the String path between &lt;source&gt; and the tag folder.</span>
</span><span class='line'>    <span class="c1">#  +tag+     is the tag currently being processed.</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">tag_dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@site</span> <span class="o">=</span> <span class="n">site</span>
</span><span class='line'>      <span class="vi">@base</span> <span class="o">=</span> <span class="n">base</span>
</span><span class='line'>      <span class="vi">@dir</span>  <span class="o">=</span> <span class="n">tag_dir</span>
</span><span class='line'>      <span class="vi">@name</span> <span class="o">=</span> <span class="s1">&#39;atom.xml&#39;</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="vi">@name</span><span class="p">)</span>
</span><span class='line'>      <span class="c1"># Read the YAML data from the layout page.</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">read_yaml</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;_includes/custom&#39;</span><span class="p">),</span> <span class="s1">&#39;tag_feed.xml&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;tag&#39;</span><span class="o">]</span>    <span class="o">=</span> <span class="n">tag</span>
</span><span class='line'>      <span class="c1"># Set the title for this page.</span>
</span><span class='line'>      <span class="n">title_prefix</span>             <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="s1">&#39;tag_title_prefix&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;Tag: &#39;</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;title&#39;</span><span class="o">]</span>       <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">title_prefix</span><span class="si">}#{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="c1"># Set the meta-description for this page.</span>
</span><span class='line'>      <span class="n">meta_description_prefix</span>  <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="s1">&#39;tag_meta_description_prefix&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;Tag: &#39;</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;description&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">meta_description_prefix</span><span class="si">}#{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Set the correct feed URL.</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;feed_url&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">tag_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># The Site class is a built-in Jekyll class with access to global site config information.</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Site</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Creates an instance of tagIndex for each tag page, renders it, and</span>
</span><span class='line'>    <span class="c1"># writes the output to a file.</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1">#  +tag_dir+ is the String path to the tag folder.</span>
</span><span class='line'>    <span class="c1">#  +tag+     is the tag currently being processed.</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">write_tag_index</span><span class="p">(</span><span class="n">tag_dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>      <span class="n">index</span> <span class="o">=</span> <span class="no">TagIndex</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">tag_dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>      <span class="n">index</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">layouts</span><span class="p">,</span> <span class="n">site_payload</span><span class="p">)</span>
</span><span class='line'>      <span class="n">index</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>
</span><span class='line'>      <span class="c1"># Record the fact that this page has been added, otherwise Site::cleanup will remove it.</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">pages</span> <span class="o">&lt;&lt;</span> <span class="n">index</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Create an Atom-feed for each index.</span>
</span><span class='line'>      <span class="n">feed</span> <span class="o">=</span> <span class="no">TagFeed</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">tag_dir</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>      <span class="n">feed</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">layouts</span><span class="p">,</span> <span class="n">site_payload</span><span class="p">)</span>
</span><span class='line'>      <span class="n">feed</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>
</span><span class='line'>      <span class="c1"># Record the fact that this page has been added, otherwise Site::cleanup will remove it.</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">pages</span> <span class="o">&lt;&lt;</span> <span class="n">feed</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Loops through the list of tag pages and processes each one.</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">write_tag_indexes</span>
</span><span class='line'>      <span class="k">if</span> <span class="nb">self</span><span class="o">.</span><span class="n">layouts</span><span class="o">.</span><span class="n">key?</span> <span class="s1">&#39;tag_index&#39;</span>
</span><span class='line'>        <span class="n">dir</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="s1">&#39;tag_dir&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;tags&#39;</span>
</span><span class='line'>        <span class="nb">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tag</span><span class="o">|</span>
</span><span class='line'>          <span class="nb">self</span><span class="o">.</span><span class="n">write_tag_index</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">tag</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/_|\P{Word}/</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/-{2,}/</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span><span class="p">),</span> <span class="n">tag</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Throw an exception if the layout couldn&#39;t be found.</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="kp">throw</span> <span class="s2">&quot;No &#39;tag_index&#39; layout found.&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Jekyll hook - the generate method is called by jekyll, and generates all of the tag pages.</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">GenerateTags</span> <span class="o">&lt;</span> <span class="no">Generator</span>
</span><span class='line'>    <span class="n">safe</span> <span class="kp">true</span>
</span><span class='line'>    <span class="n">priority</span> <span class="ss">:low</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
</span><span class='line'>      <span class="n">site</span><span class="o">.</span><span class="n">write_tag_indexes</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Adds some extra filters used during the tag creation process.</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Filters</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Outputs a list of tags as comma-separated &lt;a&gt; links. This is used</span>
</span><span class='line'>    <span class="c1"># to output the tag list for each post on a tag page.</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1">#  +tags+ is the list of tags to format.</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Returns string</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">tag_links</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
</span><span class='line'>      <span class="n">dir</span> <span class="o">=</span> <span class="vi">@context</span><span class="o">.</span><span class="n">registers</span><span class="o">[</span><span class="ss">:site</span><span class="o">].</span><span class="n">config</span><span class="o">[</span><span class="s1">&#39;tag_dir&#39;</span><span class="o">]</span>
</span><span class='line'>      <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">sort!</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
</span><span class='line'>        <span class="s2">&quot;&lt;a class=&#39;category&#39; href=&#39;/</span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">item</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/_|\P{Word}/</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/-{2,}/</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span><span class="si">}</span><span class="s2">/&#39;&gt;</span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">&lt;/a&gt;&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">case</span> <span class="n">tags</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>      <span class="k">when</span> <span class="mi">0</span>
</span><span class='line'>        <span class="s2">&quot;&quot;</span>
</span><span class='line'>      <span class="k">when</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">tags</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">to_s</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="s2">&quot;</span><span class="si">#{</span><span class="n">tags</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">-</span><span class="mi">1</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">tags</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Outputs the post.date as formatted html, with hooks for CSS styling.</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1">#  +date+ is the date object to format as HTML.</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Returns string</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">date_to_html_string</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;month&quot;&gt;&#39;</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upcase</span> <span class="o">+</span> <span class="s1">&#39;&lt;/span&gt; &#39;</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">+=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;&lt;span class=&quot;day&quot;&gt;%d&lt;/span&gt; &#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">+=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;&lt;span class=&quot;year&quot;&gt;%Y&lt;/span&gt; &#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">result</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>生成Tag Cloud</h3>

<p>保留原来的plugin/category_cloud.rb，重新添加tag_cloud.rb，将category_cloud.rb源码进行如下修改，并保存至tag_cloud.rb，通读了一下代码大致就是根据已经生成的tag列表以生成flash object标签并通过flashvars传入flash中要使用的参数。</p>

<figure class='code'><figcaption><span>tag_cloud.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Jekyll</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="nc">TagCloud</span> <span class="o">&lt;</span> <span class="ss">Liquid</span><span class="p">:</span><span class="ss">:Tag</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">markup</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@opts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>      <span class="vi">@opts</span><span class="o">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span>
</span><span class='line'>      <span class="vi">@opts</span><span class="o">[</span><span class="s1">&#39;tcolor1&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;#333333&#39;</span>
</span><span class='line'>      <span class="vi">@opts</span><span class="o">[</span><span class="s1">&#39;tcolor2&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;#333333&#39;</span>
</span><span class='line'>      <span class="vi">@opts</span><span class="o">[</span><span class="s1">&#39;hicolor&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">opt_names</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="p">,</span> <span class="s1">&#39;tcolor1&#39;</span><span class="p">,</span> <span class="s1">&#39;tcolor2&#39;</span><span class="p">,</span> <span class="s1">&#39;hicolor&#39;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">opt_names</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">opt_name</span><span class="o">|</span>
</span><span class='line'>          <span class="k">if</span> <span class="n">markup</span><span class="o">.</span><span class="n">strip</span> <span class="o">=~</span> <span class="sr">/\s*</span><span class="si">#{</span><span class="n">opt_name</span><span class="si">}</span><span class="sr">:(#[0-9a-fA-F]+)/iu</span>
</span><span class='line'>            <span class="vi">@opts</span><span class="o">[</span><span class="n">opt_name</span><span class="o">]</span> <span class="o">=</span> <span class="vg">$1</span>
</span><span class='line'>            <span class="n">markup</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sr">/</span><span class="si">#{</span><span class="n">opt_name</span><span class="si">}</span><span class="sr">:\w+/iu</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">opt_names</span> <span class="o">=</span> <span class="n">opt_names</span><span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">3</span><span class="o">]</span>
</span><span class='line'>      <span class="n">opt_names</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">opt_name</span><span class="o">|</span>
</span><span class='line'>          <span class="vi">@opts</span><span class="o">[</span><span class="n">opt_name</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;0x&#39;</span> <span class="o">+</span> <span class="vi">@opts</span><span class="o">[</span><span class="n">opt_name</span><span class="o">][</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">8</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">super</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span class='line'>      <span class="n">lists</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>      <span class="n">max</span><span class="p">,</span> <span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'>      <span class="n">config</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">registers</span><span class="o">[</span><span class="ss">:site</span><span class="o">].</span><span class="n">config</span>
</span><span class='line'>      <span class="n">tag_dir</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s1">&#39;url&#39;</span><span class="o">]</span> <span class="o">+</span> <span class="n">config</span><span class="o">[</span><span class="s1">&#39;root&#39;</span><span class="o">]</span> <span class="o">+</span> <span class="n">config</span><span class="o">[</span><span class="s1">&#39;tag_dir&#39;</span><span class="o">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span class='line'>      <span class="n">tags</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">registers</span><span class="o">[</span><span class="ss">:site</span><span class="o">].</span><span class="n">tags</span>
</span><span class='line'>      <span class="n">tags</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span> <span class="o">|</span><span class="n">str</span><span class="o">|</span> <span class="n">str</span><span class="o">.</span><span class="n">downcase</span> <span class="p">}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tag</span><span class="o">|</span>
</span><span class='line'>        <span class="n">count</span> <span class="o">=</span> <span class="n">tags</span><span class="o">[</span><span class="n">tag</span><span class="o">].</span><span class="n">count</span>
</span><span class='line'>        <span class="n">lists</span><span class="o">[</span><span class="n">tag</span><span class="o">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span class='line'>        <span class="n">max</span> <span class="o">=</span> <span class="n">count</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">max</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">bgcolor</span> <span class="o">=</span> <span class="vi">@opts</span><span class="o">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">bgcolor</span> <span class="o">=</span> <span class="vi">@opts</span><span class="o">[</span><span class="s1">&#39;bgcolor&#39;</span><span class="o">]</span>
</span><span class='line'>      <span class="n">tcolor1</span> <span class="o">=</span> <span class="vi">@opts</span><span class="o">[</span><span class="s1">&#39;tcolor1&#39;</span><span class="o">]</span>
</span><span class='line'>      <span class="n">tcolor2</span> <span class="o">=</span> <span class="vi">@opts</span><span class="o">[</span><span class="s1">&#39;tcolor2&#39;</span><span class="o">]</span>
</span><span class='line'>      <span class="n">hicolor</span> <span class="o">=</span> <span class="vi">@opts</span><span class="o">[</span><span class="s1">&#39;hicolor&#39;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>      <span class="n">html</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;&lt;embed type=&#39;application/x-shockwave-flash&#39; src=&#39;/javascripts/tagcloud.swf&#39;&quot;</span>
</span><span class='line'>      <span class="n">html</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;width=&#39;100%&#39; height=&#39;250&#39; bgcolor=&#39;</span><span class="si">#{</span><span class="n">bgcolor</span><span class="si">}</span><span class="s2">&#39; id=&#39;tagcloudflash&#39; name=&#39;tagcloudflash&#39; quality=&#39;high&#39; allowscriptaccess=&#39;always&#39;&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">html</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;flashvars=&quot;&#39;</span>
</span><span class='line'>      <span class="n">html</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;tcolor=</span><span class="si">#{</span><span class="n">tcolor1</span><span class="si">}</span><span class="s2">&amp;amp;tcolor2=</span><span class="si">#{</span><span class="n">tcolor2</span><span class="si">}</span><span class="s2">&amp;amp;hicolor=</span><span class="si">#{</span><span class="n">hicolor</span><span class="si">}</span><span class="s2">&amp;amp;tspeed=100&amp;amp;distr=true&amp;amp;mode=tags&amp;amp;&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">html</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;tagcloud=&#39;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">tagcloud</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>      <span class="n">tagcloud</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;&lt;tags&gt;&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="n">lists</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span> <span class="n">tag</span><span class="p">,</span> <span class="n">counter</span> <span class="o">|</span>
</span><span class='line'>        <span class="n">url</span> <span class="o">=</span> <span class="n">tag_dir</span> <span class="o">+</span> <span class="n">tag</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/_|\P{Word}/u</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/-{2,}/u</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>        <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;font-size: </span><span class="si">#{</span><span class="mi">10</span> <span class="o">+</span> <span class="p">(</span><span class="mi">40</span> <span class="o">*</span> <span class="nb">Float</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="o">/</span><span class="n">max</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">tagcloud</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;&lt;a href=&#39;</span><span class="si">#{</span><span class="n">url</span><span class="si">}</span><span class="s2">&#39; style=&#39;</span><span class="si">#{</span><span class="n">style</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">#{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>        <span class="n">tagcloud</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;&lt;/a&gt; &quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">tagcloud</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;&lt;/tags&gt;&#39;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># tagcloud urlencode</span>
</span><span class='line'>      <span class="n">tagcloud</span> <span class="o">=</span> <span class="no">CGI</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">tagcloud</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">html</span> <span class="o">&lt;&lt;</span> <span class="n">tagcloud</span>
</span><span class='line'>      <span class="n">html</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;&quot;&gt;&#39;</span>
</span><span class='line'>      <span class="n">html</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="ss">Liquid</span><span class="p">:</span><span class="ss">:Template</span><span class="o">.</span><span class="n">register_tag</span><span class="p">(</span><span class="s1">&#39;tag_cloud&#39;</span><span class="p">,</span> <span class="ss">Jekyll</span><span class="p">:</span><span class="ss">:TagCloud</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Tag页</h3>

<p>在source/_layout目录下创建tag_index.html文件，可以参照category_index.html。将其中变量修改为tag相关</p>

<figure class='code'><figcaption><span>tag_index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>---
</span><span class='line'>layout: page
</span><span class='line'>footer: false
</span><span class='line'>---
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;blog-archives&quot;</span> <span class="na">class=</span><span class="s">&quot;category&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>{ % for post in site.tags[page.tag] % }
</span><span class='line'>{ % capture this_year % }{ % endcapture % }
</span><span class='line'>{ % unless year == this_year % }
</span><span class='line'>    { % assign year = this_year % }
</span><span class='line'>    <span class="nt">&lt;h2&gt;</span><span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>{ % endunless % }
</span><span class='line'><span class="nt">&lt;article&gt;</span>
</span><span class='line'>    { % include archive_post.html % }
</span><span class='line'><span class="nt">&lt;/article&gt;</span>
</span><span class='line'>{ % endfor % }
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Post页</h3>

<p>blog正文下部显示tag标签模板，具体代码模板如下
_layout/post.html在footer标签中添加如下代码，引用了post/tags.html，其实写一起也可以，但条例就显得不清了。</p>

<figure class='code'><figcaption><span>post.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;meta&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    Tags: { % include post/tags.html % }
</span><span class='line'><span class="nt">&lt;/p&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>_includes/post目录下的tags.html代码如下：</p>

<figure class='code'><figcaption><span>tag.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{ % capture tag % }
</span><span class='line'>{ % if post % }
</span><span class='line'>{ { post.tags | tag_links | size } }
</span><span class='line'>{ % else % }
</span><span class='line'>{ { page.tags | tag_links | size } }
</span><span class='line'>{ % endif % }
</span><span class='line'>{ % endcapture % }
</span><span class='line'>{ % unless tag == &#39;0&#39; % }
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;categories&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    { % if post % }
</span><span class='line'>        { { post.tags | tag_links } }
</span><span class='line'>    { % else % }
</span><span class='line'>        { { page.tags | tag_links } }
</span><span class='line'>    { % endif % }
</span><span class='line'><span class="nt">&lt;/span&gt;</span>
</span><span class='line'>{ % endunless % }
</span></code></pre></td></tr></table></div></figure>


<h3>配置</h3>

<p>修改配置文件_config.yml，添加tag_dir选项</p>

<figure class='code'><figcaption><span>_config.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">tag_dir</span><span class="p">:</span> <span class="n">blog</span><span class="o">/</span><span class="n">tags</span>
</span></code></pre></td></tr></table></div></figure>


<h3>边栏模板</h3>

<p>修改custom/asides目录下的模板文件tag_cloud.html
这个在原文里发觉作者漏了，但是下面的评论有人给补充了，贴上代码</p>

<figure class='code'><figcaption><span>tag_cloud.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">&lt;section&gt;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">&lt;h1&gt;Tag Cloud&lt;/h1&gt;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">&lt;span id=&quot;tag-cloud&quot;&gt;{ % category_cloud bgcolor:#f2f2f2 % }&lt;/span&gt;</span>
</span><span class='line'><span class="l-Scalar-Plain">&lt;/section&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样tag cloud就完成了。</p>

<ul>
<li>使用代码高亮时不知为何rb语言标识符无法解析以致于{ 和 %之间多加了个空格，暂时还没有找到原因</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Makefile 测试]]></title>
    <link href="http://blog.songyee.com/blog/2013/01/18/makefile-ce-shi/"/>
    <updated>2013-01-18T16:56:00+08:00</updated>
    <id>http://blog.songyee.com/blog/2013/01/18/makefile-ce-shi</id>
    <content type="html"><![CDATA[<p>Makefile脚本中应使用tab替代空格，参见<a href="http://blog.songyee.com/blog/2013/01/17/octopressda-jian-github-pages/">上篇</a> Makefile部分</p>

<!--more-->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>blog:
</span><span class='line'>    git pull <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    rake setup_github_pages<span class="se">\[</span>git@github.com:s0ngyee/s0ngyee.github.git<span class="se">\]</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    bundle install <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    rake integrate <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    rake generate <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    rake deploy <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    git add .; <span class="se">\</span>
</span><span class='line'>    git commit -am <span class="s2">&quot;${MSG}&quot;</span>; <span class="se">\</span>
</span><span class='line'>    git push origin master
</span><span class='line'>.PHONY: blog%
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress搭建github pages]]></title>
    <link href="http://blog.songyee.com/blog/2013/01/17/octopressda-jian-github-pages/"/>
    <updated>2013-01-17T17:21:00+08:00</updated>
    <id>http://blog.songyee.com/blog/2013/01/17/octopressda-jian-github-pages</id>
    <content type="html"><![CDATA[<p>折腾一天终于有所进展了。<br />
看了N篇blog，相关联的知识也找了不少磕磕绊绊的。<br />
写篇日志总结一下，文思如尿路，给自己看，不奢求写的有多流畅有多完美。</p>

<!-- more -->


<h3>简介</h3>

<p><a href="http://octopress.org/">Octopress</a>是使用Ruby语言编写的建立在jekyll上的一套blog系统。</p>

<p>优点:<br />
使用<a href="http://zh.wikipedia.org/wiki/Markdown">markdown</a>标记语言编写文章。<br />
与git集成，通过git对blog进行维护。<br />
可以与github pages进行集成，将个人blog免费托管在github上。<br /></p>

<p>个人缺乏相关知识:<br />
没有接触ruby及相关运行环境，对gem, rake, bundle等工具或类库没有概念。<br />
github没有实际做过代码托管。<br /></p>

<h3>Ruby</h3>

<h4>安装</h4>

<p>一开始采用源码编译的方式进行安装，之后发现无法解析yml文件，编译时忘记加入依赖类库的。惰性使然没有去找依赖类库重新编译，同学推荐rvm的方式来进行安装和管理，果断换一种方式。</p>

<h4>RVM</h4>

<p>安装RVM</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>bash -s stable &lt; &lt;<span class="o">(</span>curl -s https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>安装Ruby</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rvm install 1.9.3 <span class="o">&amp;&amp;</span> rvm use 1.9.3
</span></code></pre></td></tr></table></div></figure>


<h4>Gem</h4>

<p>RubyGems（简称 gems）是一个用于对 Rails 组件进行打包的 Ruby 打包系统。 它提供一个分发 Ruby 程序和库的标准格式，还提供一个管理程序包安装的工具。</p>

<p>详细介绍参阅了<a href="http://lanvige.iteye.com/blog/804477">这篇</a></p>

<h4>Bundle</h4>

<p>octopress安装过程中有用到bundle命令，顺便提一下bundle是用来管理项目中所有gem的依赖
Gem介绍中对bundle也有说明</p>

<h4>Rake</h4>

<p>简单而言，Rake是一个由ruby编写的build工具。</p>

<p>Rake是由ruby实现的，它的rakefile完全是由ruby语法定义的，所以它是一种内部DSL&#8211;基于另一种语言（宿主语言）编写的DSL。</p>

<p>参见<a href="http://rails-weekly.group.iteye.com/group/wiki/1830-rails-questions-weekly-15-rake">这里</a></p>

<hr />

<h3>github</h3>

<p>需要安装git，这里使用Mountain Lion内置的。</p>

<p>在本机生成ssh key，按着github上的<a href="https://help.github.com/articles/generating-ssh-keys">help</a>做的，将公钥加入github的帐户中。</p>

<p>在github上<a href="https://github.com/new">创建</a>一个版本库，因为后面要将octopress和github pages进行集成，版本库名称应为username.github.com</p>

<hr />

<h3>Octopress</h3>

<h4>安装</h4>

<ul>
<li>获取源码</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone git://github.com/imathis/octopress.git octopress
</span><span class='line'>ruby --version  //Ruby的版本需要在1.9.2版本以上
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>安装依赖插件</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem install bundler
</span><span class='line'>bundle install
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>安装主题</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rake install
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>配置blog
参见<a href="http://octopress.org/docs/configuring/">这里</a></p></li>
<li><p>配置github分支</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rake setup_github_pages
</span></code></pre></td></tr></table></div></figure>


<p>执行后会提示输入git的URL，输入刚才建立的git地址</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git@github.com:username/username.github.com.git
</span></code></pre></td></tr></table></div></figure>


<h4>发表文章</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rake new_post<span class="o">[</span><span class="s1">&#39;post name&#39;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>在source/_post目录下会根据当前日期生成相应的目录以及文章的.markdown文件，使用markdown语言对文章内容进行编辑。</p>

<h4>生成预览</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rake generate
</span><span class='line'>rake preview
</span></code></pre></td></tr></table></div></figure>


<p>就可以在本地<a href="http://localhost:4000">http://localhost:4000</a>预览了。</p>

<h4>提交</h4>

<p>最后使用以下命令将blog内容提交到github上。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rake deploy
</span></code></pre></td></tr></table></div></figure>


<h4>提交源码</h4>

<p>上一步完成以后，_deploy里的blog内容已经提交到了github上，并可以通过github pages进行访问了。此时本地git分支也会自动切换到source分支，最后将blog源码也提交到github上方便以后维护。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git add .
</span><span class='line'>git commit -m <span class="s1">&#39;commit message&#39;</span>
</span><span class='line'>git push origin <span class="nb">source</span>
</span></code></pre></td></tr></table></div></figure>


<p>至此octopress基本功能部署完成，接下来就是对blog进行customize，目前为止就整了两个部分，如下所示。</p>

<h4>个性化域名</h4>

<p>想使用custom domain来替换原来的s0ngyee.github.com，依照教程所做的在根目录下创建CNAME文件内容为customize domain，可用以下命令进行创建</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="s1">&#39;your-domain.com&#39;</span> &gt;&gt; <span class="nb">source</span>/CNAME
</span></code></pre></td></tr></table></div></figure>


<p>然后在域名服务器上将二级域名指向到207.97.227.245，等域名服务器刷新便可以了。</p>

<hr />

<h3>插件及模板修改</h3>

<p>现在还缺少友情链接，文章评论的功能，关于的页面尚未完成。如有修改会及时进行记录。</p>

<h4>分类列表</h4>

<p>主要步骤如下</p>

<ul>
<li>编写基于Jekyll的插件，并在模板引擎中注册分类标签类，本人不懂ruby就看了个大概。</li>
<li>在边栏引用目录中添加新的边栏模板文件</li>
<li>修改配置文件边栏项</li>
</ul>


<p>详细参见<a href="http://codemacro.com/2012/07/18/add-category-list-to-octopress/">这篇</a></p>

<h4>微博分享</h4>

<p>今天在文章结尾处添加了微博分享的功能，照<a href="http://programus.github.com/blog/2012/03/04/share-weibo-button/">葫芦</a>画瓢跟着做。去新浪微博<a href="http://open.weibo.com/sharebutton">分享按钮</a>，生成按钮代码（最终是获取document.write里的那一段iframe代码）。等待测试&#8230;</p>

<hr />

<h3>Other</h3>

<h4>Markdown语法</h4>

<p>Markdown 是一种轻量级标记语言，创始人为John Gruber和Aaron Swartz。它允许人们“使用易读易写的纯文本格式编写文档，然后转换成有效的XHTML(或者HTML)文档”。[1]这种语言吸收了很多在电子邮件中已有的纯文本标记的特性。</p>

<p><a href="http://wowubuntu.com/markdown/">Markdown 语法说明</a></p>

<h5>Makefile</h5>

<p>同学给了一个Makefile文件，可以通过make命令直接发布blog，修改源码的时候看到Makefile最后有一个.PHONY不太明白于是又补了一下<a href="http://blog.csdn.net/xjtuse_mal/article/details/5404894">相关知识</a>，对这个稍稍有了了解。</p>

<p>在一个老外的<a href="http://kvz.io/blog/2012/09/25/blog-with-octopress/">blog</a>上找到了这段Makefile的出处</p>

<hr />

<h3>总结</h3>

<p>回顾一下整个安装部署流程，对于ruby一窍不同的我显得十分费力，折腾了两天体会到同学之前说的 ，如果相关知识都了解的话，半个小时一个小时就可以搞定的。全部流程走一遍，对一些名词总算有些概念了。</p>

<p>实在记不下这么多，还是用写的踏实点，之前一年养成用evernote的习惯，希望之后能够慢慢加强一下，记笔记的同时顺便将重要的东西发布在blog上。本篇还是边抄别人边自己总结，一字一字码出来的，虽说自己内容不多，只是把别人的东西重新组织整理了一下。</p>

<hr />

<h3>参考</h3>

<h4><a href="http://octopress.org/docs/deploying/github/">Deploying to Github Pages</a></h4>

<h4><a href="http://octopress.org/docs/configuring/">Configuring Octopress</a></h4>

<h4><a href="http://octopress.org/docs/deploying/github/">Deploying to Github Pages</a></h4>

<h4><a href="https://github.com/imathis/octopress/wiki/3rd-party-plugins">3rd-party-plugins</a></h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[准备挪窝了]]></title>
    <link href="http://blog.songyee.com/blog/2013/01/17/zhun-bei-nuo-wo-liao/"/>
    <updated>2013-01-17T07:22:00+08:00</updated>
    <id>http://blog.songyee.com/blog/2013/01/17/zhun-bei-nuo-wo-liao</id>
    <content type="html"><![CDATA[<p>上周同学推荐octopress+github pages 托管在github上，减轻服务器负担考虑把blog迁移到这里。折腾了一天弄出来个基本的终于能写blog了，尽快熟悉起来以后东西都记这里了。</p>
]]></content>
  </entry>
  
</feed>
